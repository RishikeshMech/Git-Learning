<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yearly Effort Saved Report Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            padding: 16px;
            min-height: 100vh;
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4a90e2 0%, #5ba3f5 100%);
            color: white;
            padding: 20px 24px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .header p {
            font-size: 13px;
            opacity: 0.95;
        }

        .content {
            padding: 20px 24px;
        }

        .section {
            margin-bottom: 20px;
            padding: 16px;
            background: #fafbfc;
            border-radius: 6px;
            border-left: 3px solid #4a90e2;
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 16px;
            font-weight: 600;
        }

        .input-group {
            margin-bottom: 12px;
        }

        .input-group label {
            display: block;
            margin-bottom: 4px;
            color: #4a5568;
            font-weight: 500;
            font-size: 13px;
        }

        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.2s;
            background: white;
        }

        .input-group input:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #4a90e2;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }

        .input-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .file-input-wrapper input[type=file] {
            display: none;
        }

        .file-input-label {
            display: block;
            padding: 10px 16px;
            background: #4a90e2;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
        }

        .file-input-label:hover {
            background: #3a7bc8;
        }

        .btn {
            padding: 10px 20px;
            background: #4a90e2;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            margin-right: 8px;
            margin-top: 8px;
        }

        .btn:hover {
            background: #3a7bc8;
        }

        .btn-success {
            background: #10b981;
        }

        .btn-success:hover {
            background: #059669;
        }

        .preview-section {
            margin-top: 20px;
            padding: 16px;
            background: #fff;
            border: 1px dashed #e2e8f0;
            border-radius: 6px;
        }

        .preview-section h2 {
            margin-bottom: 12px;
            font-size: 16px;
            color: #2c3e50;
        }

        .email-preview {
            max-width: 800px;
            margin: 0 auto;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }

        .email-preview iframe {
            width: 100%;
            min-height: 600px;
            border: none;
        }

        .info-text {
            color: #718096;
            font-size: 12px;
            margin-top: 4px;
        }

        .hidden {
            display: none;
        }

        .button-group {
            text-align: center;
            margin: 30px 0;
        }

        .compatibility-note {
            background: #e8f4fd;
            border: 1px solid #4a90e2;
            border-radius: 4px;
            padding: 12px;
            margin-top: 16px;
            font-size: 12px;
            color: #2c3e50;
        }

        .compatibility-note strong {
            display: block;
            margin-bottom: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Yearly Effort Saved Report Generator</h1>
            <p>Create Outlook-Compatible Email Templates (MSO/VML)</p>
        </div>

        <div class="content">
            <!-- Configuration Section -->
            <div class="section">
                <h2>üìù Report Configuration</h2>
                <div class="input-group">
                    <label for="fyYear">Financial Year (e.g., 24-25)</label>
                    <input type="text" id="fyYear" value="24-25" placeholder="24-25">
                </div>
                <div class="input-group">
                    <label for="senderName">Your Name</label>
                    <input type="text" id="senderName" value="Automation Team Lead" placeholder="Your Name">
                </div>
                <div class="input-group">
                    <label for="senderTitle">Your Title</label>
                    <input type="text" id="senderTitle" value="Lead - Automation Team" placeholder="Your Title">
                </div>
                <div class="input-group">
                    <label for="senderEmail">Your Email</label>
                    <input type="email" id="senderEmail" value="automation.lead@company.com" placeholder="your.email@company.com">
                </div>
                <div class="input-group">
                    <label for="companyName">Company/Department Name</label>
                    <input type="text" id="companyName" value="Automation Team" placeholder="Company/Department Name">
                </div>
            </div>

            <!-- CSV Upload Section -->
            <div class="section">
                <h2>üìÅ Upload CSV Data</h2>
                <div class="input-group">
                    <label>Select CSV File</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="csvFile" accept=".csv">
                        <label for="csvFile" class="file-input-label">Choose CSV File</label>
                    </div>
                    <p class="info-text">CSV should have columns: Track Name, Use Case, Efforts Saved Per Month (Months), Efforts Saved Per Year (Hours)</p>
                </div>
                <button class="btn" onclick="loadDefaultData()">Load Sample Data</button>
            </div>

            <!-- Email Content Section -->
            <div class="section">
                <h2>‚úâÔ∏è Email Content</h2>
                <div class="input-group">
                    <label for="emailGreeting">Greeting</label>
                    <input type="text" id="emailGreeting" value="Dear Team," placeholder="Dear Team,">
                </div>
                <div class="input-group">
                    <label for="emailIntro">Introduction Text</label>
                    <textarea id="emailIntro">We are pleased to share that for the Financial Year 24-25, our Automation Team has achieved significant milestones in effort optimization and process efficiency.</textarea>
                </div>
                <div class="input-group">
                    <label for="emailPlanned">Planned Use Cases Text</label>
                    <textarea id="emailPlanned">Currently, we have many planned use cases in our pipeline that may prove even more effective in the coming months. Our continuous improvement initiatives are focused on expanding automation coverage and enhancing operational efficiency across all business units.</textarea>
                </div>
                <div class="input-group">
                    <label for="emailClosing">Closing Text</label>
                    <textarea id="emailClosing">Thank you for your continued support and collaboration. We look forward to sharing more updates as we progress with our automation initiatives.</textarea>
                </div>
            </div>

            <!-- Generate Buttons -->
            <div class="button-group">
                <button class="btn btn-success" onclick="generateEmail()">üöÄ Generate Email Template</button>
                <button class="btn" onclick="downloadHTML()" id="downloadBtn" style="display: none;">üíæ Download HTML</button>
                <button class="btn" onclick="copyHTML()" id="copyBtn" style="display: none;">üìã Copy HTML</button>
            </div>

            <!-- Preview Section -->
            <div class="preview-section hidden" id="previewSection">
                <h2>üìß Email Preview (Outlook Compatible)</h2>
                <div class="compatibility-note">
                    <strong>‚úì Outlook Compatibility Features:</strong>
                    ‚Ä¢ VML gradients for header backgrounds<br>
                    ‚Ä¢ MSO conditional comments for Outlook-specific rendering<br>
                    ‚Ä¢ Table-based layout (no CSS Grid/Flexbox)<br>
                    ‚Ä¢ Inline styles throughout<br>
                    ‚Ä¢ Static chart representation using tables
                </div>
                <div class="email-preview">
                    <iframe id="emailPreviewFrame" title="Email Preview"></iframe>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let csvData = [];
        let generatedEmailHTML = '';

        // Default CSV data
        const DEFAULT_CSV_DATA = `Track Name,Use Case,Efforts Saved Per Month (Months),Efforts Saved Per Year (Hours)
RPA Automation,Invoice Processing,1.2,120
RPA Automation,Data Entry,1.3,130
Process Optimization,Workflow Streamlining,1.8,180
Data Migration,Legacy System Migration,3.2,320
Workflow Automation,Approval Automation,2.1,210
System Integration,API Integration,1.5,150
Quality Assurance,Automated Testing,1.2,120
Reporting Automation,Dashboard Generation,0.9,90`;

        // Load default data
        function loadDefaultData() {
            parseCSV(DEFAULT_CSV_DATA);
            alert('Sample data loaded successfully! ' + csvData.length + ' records found.');
        }

        // Parse CSV data
        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            
            const trackIndex = headers.findIndex(h => h.toLowerCase().includes('track'));
            const useCaseIndex = headers.findIndex(h => h.toLowerCase().includes('use case') || h.toLowerCase().includes('usecase'));
            const monthlyIndex = headers.findIndex(h => h.toLowerCase().includes('month'));
            const yearlyIndex = headers.findIndex(h => h.toLowerCase().includes('year'));
            
            csvData = [];
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim());
                if (values.length >= 2) {
                    const trackName = trackIndex >= 0 ? values[trackIndex] : values[0];
                    const useCase = useCaseIndex >= 0 ? values[useCaseIndex] : trackName;
                    const monthlyEffort = monthlyIndex >= 0 ? parseFloat(values[monthlyIndex]) || 0 : 0;
                    const yearlyEffort = yearlyIndex >= 0 ? parseFloat(values[yearlyIndex]) || 0 : monthlyEffort * 12;
                    
                    csvData.push({
                        trackName: trackName || '',
                        useCase: useCase || trackName,
                        monthlyEffort: monthlyEffort,
                        yearlyEffort: yearlyEffort
                    });
                }
            }
        }

        // Handle CSV file upload
        document.getElementById('csvFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    parseCSV(event.target.result);
                    alert('CSV file loaded successfully! ' + csvData.length + ' records found.');
                };
                reader.readAsText(file);
            }
        });

        // Calculate totals
        function calculateTotals() {
            const totalHours = csvData.reduce((sum, item) => sum + item.yearlyEffort, 0);
            const totalMonths = csvData.reduce((sum, item) => sum + item.monthlyEffort, 0);
            
            // Group by track
            const trackGroups = {};
            csvData.forEach(item => {
                if (!trackGroups[item.trackName]) {
                    trackGroups[item.trackName] = {
                        trackName: item.trackName,
                        monthlyEffort: 0,
                        yearlyEffort: 0,
                        useCases: []
                    };
                }
                trackGroups[item.trackName].monthlyEffort += item.monthlyEffort;
                trackGroups[item.trackName].yearlyEffort += item.yearlyEffort;
                trackGroups[item.trackName].useCases.push({
                    name: item.useCase,
                    monthlyEffort: item.monthlyEffort,
                    yearlyEffort: item.yearlyEffort
                });
            });
            
            return {
                totalHours,
                totalMonths,
                trackCount: Object.keys(trackGroups).length,
                useCaseCount: csvData.length,
                trackData: Object.values(trackGroups)
            };
        }

        // Excel color palette
        const EXCEL_COLORS = [
            '#4472C4', '#ED7D31', '#A5A5A5', '#FFC000',
            '#5B9BD5', '#70AD47', '#7030A0', '#C00000',
            '#0070C0', '#00B050', '#FF0000', '#002060'
        ];

        // Generate chart legend HTML (static representation)
        function generateChartLegend(data, totalHours) {
            let legendHTML = '';
            data.forEach((item, index) => {
                const color = EXCEL_COLORS[index % EXCEL_COLORS.length];
                const percentage = ((item.yearlyEffort / totalHours) * 100).toFixed(1);
                legendHTML += `
                    <tr>
                        <td style="padding: 4px 8px; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 12px;">
                            <table cellpadding="0" cellspacing="0" border="0">
                                <tr>
                                    <td style="width: 12px; height: 12px; background-color: ${color};"></td>
                                    <td style="padding-left: 6px; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 12px;">${item.trackName}</td>
                                </tr>
                            </table>
                        </td>
                        <td style="padding: 4px 8px; text-align: right; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 12px;">${item.yearlyEffort.toLocaleString()} hrs</td>
                        <td style="padding: 4px 8px; text-align: right; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 12px;">${percentage}%</td>
                    </tr>
                `;
            });
            return legendHTML;
        }

        // Generate use case legend HTML
        function generateUseCaseLegend(data, totalHours) {
            let legendHTML = '';
            data.forEach((item, index) => {
                const color = EXCEL_COLORS[index % EXCEL_COLORS.length];
                const percentage = ((item.yearlyEffort / totalHours) * 100).toFixed(1);
                legendHTML += `
                    <tr>
                        <td style="padding: 4px 8px; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 12px;">
                            <table cellpadding="0" cellspacing="0" border="0">
                                <tr>
                                    <td style="width: 12px; height: 12px; background-color: ${color};"></td>
                                    <td style="padding-left: 6px; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 12px;">${item.useCase}</td>
                                </tr>
                            </table>
                        </td>
                        <td style="padding: 4px 8px; text-align: right; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 12px;">${item.yearlyEffort.toLocaleString()} hrs</td>
                        <td style="padding: 4px 8px; text-align: right; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 12px;">${percentage}%</td>
                    </tr>
                `;
            });
            return legendHTML;
        }

        // Generate Outlook-compatible email HTML
        function generateOutlookEmail(config, totals) {
            const { fyYear, senderName, senderTitle, senderEmail, companyName, greeting, intro, planned, closing } = config;
            
            // Generate table rows for detailed breakdown
            let tableRows = '';
            totals.trackData.forEach(track => {
                track.useCases.forEach((uc, idx) => {
                    tableRows += `
                        <tr>
                            ${idx === 0 ? `<td rowspan="${track.useCases.length}" style="padding: 8px 12px; border: 1px solid #bdc3c7; vertical-align: middle; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 13px; font-weight: bold; background-color: #f8f9fa;">${track.trackName}</td>` : ''}
                            <td style="padding: 8px 12px; border: 1px solid #bdc3c7; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 13px;">${uc.name}</td>
                            <td style="padding: 8px 12px; border: 1px solid #bdc3c7; text-align: center; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 13px;">${(uc.monthlyEffort * 160).toFixed(0)}</td>
                            <td style="padding: 8px 12px; border: 1px solid #bdc3c7; text-align: center; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 13px;">${uc.yearlyEffort.toLocaleString()}</td>
                        </tr>
                    `;
                });
            });

            return `<!DOCTYPE html>
<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!--[if !mso]><!-->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!--<![endif]-->
    <!--[if mso]>
    <noscript>
        <xml>
            <o:OfficeDocumentSettings>
                <o:AllowPNG/>
                <o:PixelsPerInch>96</o:PixelsPerInch>
            </o:OfficeDocumentSettings>
        </xml>
    </noscript>
    <![endif]-->
    <title>Yearly Effort Saved Report - FY ${fyYear}</title>
    <style type="text/css">
        /* Reset styles */
        body, table, td, p, a, li, blockquote {
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
        }
        table, td {
            mso-table-lspace: 0pt;
            mso-table-rspace: 0pt;
        }
        img {
            -ms-interpolation-mode: bicubic;
            border: 0;
            outline: none;
            text-decoration: none;
        }
        body {
            margin: 0 !important;
            padding: 0 !important;
            width: 100% !important;
        }
        /* Client-specific resets */
        .ReadMsgBody { width: 100%; }
        .ExternalClass { width: 100%; }
        .ExternalClass, .ExternalClass p, .ExternalClass span, .ExternalClass font, .ExternalClass td, .ExternalClass div {
            line-height: 100%;
        }
        /* Outlook link fix */
        #outlook a { padding: 0; }
    </style>
</head>
<body style="margin: 0; padding: 0; background-color: #f5f7fa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
    <!-- Wrapper table -->
    <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="background-color: #f5f7fa;">
        <tr>
            <td align="center" style="padding: 20px 10px;">
                <!-- Main container -->
                <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="800" style="max-width: 800px; background-color: #ffffff;">
                    
                    <!-- Header with VML gradient for Outlook -->
                    <tr>
                        <td align="center" style="padding: 0;">
                            <!--[if gte mso 9]>
                            <v:rect xmlns:v="urn:schemas-microsoft-com:vml" fill="true" stroke="false" style="width:800px;height:100px;">
                                <v:fill type="gradient" color="#667eea" color2="#764ba2" angle="135"/>
                                <v:textbox inset="0,0,0,0" style="mso-fit-shape-to-text:false;">
                            <![endif]-->
                            <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                <tr>
                                    <td align="center" style="padding: 24px 20px;">
                                        <table role="presentation" cellpadding="0" cellspacing="0" border="0">
                                            <tr>
                                                <td align="center" style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 24px; font-weight: bold; color: #ffffff; letter-spacing: 1px;">
                                                    ${companyName.toUpperCase()}
                                                </td>
                                            </tr>
                                            <tr>
                                                <td align="center" style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 16px; color: #ffffff; padding-top: 8px;">
                                                    Yearly Effort Saved Report
                                                </td>
                                            </tr>
                                            <tr>
                                                <td align="center" style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 14px; color: #ffffff; opacity: 0.9; padding-top: 4px;">
                                                    Financial Year ${fyYear}
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </table>
                            <!--[if gte mso 9]>
                                </v:textbox>
                            </v:rect>
                            <![endif]-->
                        </td>
                    </tr>

                    <!-- Email Body -->
                    <tr>
                        <td style="padding: 30px 40px;">
                            <!-- Greeting -->
                            <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%">
                                <tr>
                                    <td style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 16px; color: #2c3e50; padding-bottom: 20px;">
                                        ${greeting}
                                    </td>
                                </tr>
                                ${intro ? `
                                <tr>
                                    <td style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 14px; color: #2c3e50; line-height: 1.6; padding-bottom: 20px;">
                                        ${intro}
                                    </td>
                                </tr>
                                ` : ''}
                            </table>

                            <!-- Highlight Box -->
                            <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="margin-bottom: 25px;">
                                <tr>
                                    <td style="background-color: #f0f4ff; border-left: 4px solid #667eea; padding: 20px;">
                                        <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%">
                                            <tr>
                                                <td style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 16px; font-weight: bold; color: #2c3e50; padding-bottom: 15px;">
                                                    Key Achievements for FY ${fyYear}:
                                                </td>
                                            </tr>
                                            <tr>
                                                <td align="center" style="background-color: #ffffff; padding: 20px; border-radius: 4px;">
                                                    <span style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 36px; font-weight: bold; color: #667eea;">
                                                        ${totals.totalHours.toLocaleString()} Hours Saved
                                                    </span>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </table>

                            <!-- Stats Grid -->
                            <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="margin-bottom: 25px;">
                                <tr>
                                    <td width="25%" style="padding: 5px;">
                                        <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="border: 1px solid #e2e8f0; text-align: center;">
                                            <tr>
                                                <td style="padding: 15px 10px;">
                                                    <div style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 24px; font-weight: bold; color: #667eea;">${totals.totalHours.toLocaleString()}</div>
                                                    <div style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 12px; color: #666; margin-top: 5px;">Total Hours Saved</div>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                    <td width="25%" style="padding: 5px;">
                                        <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="border: 1px solid #e2e8f0; text-align: center;">
                                            <tr>
                                                <td style="padding: 15px 10px;">
                                                    <div style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 24px; font-weight: bold; color: #667eea;">${(totals.totalMonths * 160).toFixed(0)}</div>
                                                    <div style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 12px; color: #666; margin-top: 5px;">Hrs Saved/Month</div>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                    <td width="25%" style="padding: 5px;">
                                        <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="border: 1px solid #e2e8f0; text-align: center;">
                                            <tr>
                                                <td style="padding: 15px 10px;">
                                                    <div style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 24px; font-weight: bold; color: #667eea;">${totals.trackCount}</div>
                                                    <div style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 12px; color: #666; margin-top: 5px;">Active Tracks</div>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                    <td width="25%" style="padding: 5px;">
                                        <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="border: 1px solid #e2e8f0; text-align: center;">
                                            <tr>
                                                <td style="padding: 15px 10px;">
                                                    <div style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 24px; font-weight: bold; color: #667eea;">${totals.useCaseCount}</div>
                                                    <div style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 12px; color: #666; margin-top: 5px;">Use Cases</div>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </table>

                            <!-- Section Title -->
                            <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%">
                                <tr>
                                    <td style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 16px; font-weight: bold; color: #2c3e50; padding-bottom: 15px;">
                                        Detailed Breakdown by Track &amp; Use Case
                                    </td>
                                </tr>
                            </table>

                            <!-- Data Table -->
                            <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="border-collapse: collapse; margin-bottom: 25px;">
                                <thead>
                                    <tr>
                                        <th style="padding: 12px; background-color: #667eea; color: #ffffff; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 13px; font-weight: 600; text-align: left; border: 1px solid #5a6fd6;">Track Name</th>
                                        <th style="padding: 12px; background-color: #667eea; color: #ffffff; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 13px; font-weight: 600; text-align: left; border: 1px solid #5a6fd6;">Use Case</th>
                                        <th style="padding: 12px; background-color: #667eea; color: #ffffff; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 13px; font-weight: 600; text-align: center; border: 1px solid #5a6fd6;">Saved Hrs/Month</th>
                                        <th style="padding: 12px; background-color: #667eea; color: #ffffff; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 13px; font-weight: 600; text-align: center; border: 1px solid #5a6fd6;">Saved Hrs/Year</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${tableRows}
                                    <tr style="background-color: #f0f4ff;">
                                        <td colspan="2" style="padding: 12px; border: 1px solid #bdc3c7; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 13px; font-weight: bold;">Total</td>
                                        <td style="padding: 12px; border: 1px solid #bdc3c7; text-align: center; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 13px; font-weight: bold;">${(totals.totalMonths * 160).toFixed(0)}</td>
                                        <td style="padding: 12px; border: 1px solid #bdc3c7; text-align: center; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 13px; font-weight: bold;">${totals.totalHours.toLocaleString()}</td>
                                    </tr>
                                </tbody>
                            </table>

                            <!-- Chart Section (Static Table Representation) -->
                            <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="margin-bottom: 25px;">
                                <tr>
                                    <td width="50%" style="padding: 10px; vertical-align: top;">
                                        <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="border: 1px solid #e2e8f0;">
                                            <tr>
                                                <td style="padding: 15px; background-color: #f8f9fa;">
                                                    <div style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 14px; font-weight: bold; color: #2c3e50; margin-bottom: 15px; text-align: center;">
                                                        Distribution by Track
                                                    </div>
                                                    <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="border-collapse: collapse;">
                                                        <tr style="background-color: #667eea;">
                                                            <th style="padding: 6px 8px; color: #fff; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 11px; text-align: left;">Track</th>
                                                            <th style="padding: 6px 8px; color: #fff; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 11px; text-align: right;">Hours</th>
                                                            <th style="padding: 6px 8px; color: #fff; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 11px; text-align: right;">%</th>
                                                        </tr>
                                                        ${generateChartLegend(totals.trackData, totals.totalHours)}
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                    <td width="50%" style="padding: 10px; vertical-align: top;">
                                        <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="border: 1px solid #e2e8f0;">
                                            <tr>
                                                <td style="padding: 15px; background-color: #f8f9fa;">
                                                    <div style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 14px; font-weight: bold; color: #2c3e50; margin-bottom: 15px; text-align: center;">
                                                        Distribution by Use Case
                                                    </div>
                                                    <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="border-collapse: collapse;">
                                                        <tr style="background-color: #667eea;">
                                                            <th style="padding: 6px 8px; color: #fff; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 11px; text-align: left;">Use Case</th>
                                                            <th style="padding: 6px 8px; color: #fff; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 11px; text-align: right;">Hours</th>
                                                            <th style="padding: 6px 8px; color: #fff; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 11px; text-align: right;">%</th>
                                                        </tr>
                                                        ${generateUseCaseLegend(csvData, totals.totalHours)}
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </table>

                            ${planned ? `
                            <!-- Future Outlook -->
                            <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%">
                                <tr>
                                    <td style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 14px; font-weight: bold; color: #2c3e50; padding-bottom: 10px;">
                                        Future Outlook:
                                    </td>
                                </tr>
                                <tr>
                                    <td style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 14px; color: #2c3e50; line-height: 1.6; padding-bottom: 20px;">
                                        ${planned}
                                    </td>
                                </tr>
                            </table>
                            ` : ''}

                            ${closing ? `
                            <!-- Closing -->
                            <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%">
                                <tr>
                                    <td style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 14px; color: #2c3e50; line-height: 1.6; padding-bottom: 30px;">
                                        ${closing}
                                    </td>
                                </tr>
                            </table>
                            ` : ''}

                            <!-- Signature -->
                            <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="border-top: 2px solid #e2e8f0; padding-top: 20px;">
                                <tr>
                                    <td style="padding-top: 20px;">
                                        <div style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 15px; font-weight: bold; color: #2c3e50;">${senderName}</div>
                                        <div style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 13px; color: #555; margin-top: 4px;">${senderTitle}</div>
                                        <div style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 13px; color: #555; margin-top: 2px;">${companyName}</div>
                                        <div style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 13px; color: #667eea; margin-top: 2px;">${senderEmail}</div>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>

                    <!-- Footer -->
                    <tr>
                        <td style="background-color: #f8f9fa; padding: 20px 40px; border-top: 1px solid #e2e8f0;">
                            <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%">
                                <tr>
                                    <td align="center" style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 12px; color: #666;">
                                        This is an automated report generated by the Automation Team
                                    </td>
                                </tr>
                                <tr>
                                    <td align="center" style="font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 12px; color: #666; padding-top: 5px;">
                                        &copy; ${new Date().getFullYear()} ${companyName}. All rights reserved.
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>

                </table>
            </td>
        </tr>
    </table>
</body>
</html>`;
        }

        // Generate email
        function generateEmail() {
            if (csvData.length === 0) {
                alert('Please load CSV data first!');
                return;
            }

            const config = {
                fyYear: document.getElementById('fyYear').value || '24-25',
                senderName: document.getElementById('senderName').value || 'Automation Team Lead',
                senderTitle: document.getElementById('senderTitle').value || 'Lead - Automation Team',
                senderEmail: document.getElementById('senderEmail').value || 'automation.lead@company.com',
                companyName: document.getElementById('companyName').value || 'Automation Team',
                greeting: document.getElementById('emailGreeting').value || 'Dear Team,',
                intro: document.getElementById('emailIntro').value || '',
                planned: document.getElementById('emailPlanned').value || '',
                closing: document.getElementById('emailClosing').value || ''
            };

            const totals = calculateTotals();
            generatedEmailHTML = generateOutlookEmail(config, totals);

            // Display preview in iframe
            const iframe = document.getElementById('emailPreviewFrame');
            iframe.srcdoc = generatedEmailHTML;

            // Show preview section and buttons
            document.getElementById('previewSection').classList.remove('hidden');
            document.getElementById('downloadBtn').style.display = 'inline-block';
            document.getElementById('copyBtn').style.display = 'inline-block';
        }

        // Download HTML
        function downloadHTML() {
            if (!generatedEmailHTML) {
                alert('Please generate email first!');
                return;
            }
            
            const blob = new Blob([generatedEmailHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Effort_Saved_Report_FY_${document.getElementById('fyYear').value || '24-25'}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Copy HTML to clipboard
        function copyHTML() {
            if (!generatedEmailHTML) {
                alert('Please generate email first!');
                return;
            }
            
            navigator.clipboard.writeText(generatedEmailHTML).then(function() {
                alert('HTML copied to clipboard!');
            }).catch(function(err) {
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = generatedEmailHTML;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('HTML copied to clipboard!');
            });
        }

        // Load default data on page load
        window.addEventListener('load', function() {
            loadDefaultData();
        });
    </script>
</body>
</html>
